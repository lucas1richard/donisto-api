"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _models = require("../../../../../models");

var _keys = require("../../../../../models/keys");

var _conn = _interopRequireDefault(require("../../../../../config/database/conn"));

var _validate = require("./validate");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const createCauseController = async (req, res, next) => {
  let transaction;

  try {
    await _validate.bodySchema.validate(req.body);
    transaction = await _conn.default.transaction();
    const cause = await _models.Causes.create({
      [_keys.CauseKeys.NAME]: req.body.name,
      [_keys.CauseKeys.SUGGESTED_DONATION]: req.body.suggested_amount,
      [_keys.CauseKeys.GOAL_AMOUNT]: req.body.goal_amount
    }, {
      transaction
    });
    const organization = await _models.Organizations.findOne({
      where: {
        [_keys.OrganizationKeys.UUID]: req.body.organizationUuid
      }
    });
    await cause.setOrganization(organization, {
      transaction
    });
    await transaction.commit();
    res.status(201).json(cause);
  } catch (err) {
    if (transaction) {
      transaction.rollback();
    }

    next(err);
  }
};

var _default = createCauseController;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9yb3V0ZXMvdjEvY2F1c2UvY29udHJvbGxlcnMvY3JlYXRlQ2F1c2UvaW5kZXgudHMiXSwibmFtZXMiOlsiY3JlYXRlQ2F1c2VDb250cm9sbGVyIiwicmVxIiwicmVzIiwibmV4dCIsInRyYW5zYWN0aW9uIiwiYm9keVNjaGVtYSIsInZhbGlkYXRlIiwiYm9keSIsInNlcUluc3RhbmNlIiwiY2F1c2UiLCJDYXVzZXMiLCJjcmVhdGUiLCJDYXVzZUtleXMiLCJOQU1FIiwibmFtZSIsIlNVR0dFU1RFRF9ET05BVElPTiIsInN1Z2dlc3RlZF9hbW91bnQiLCJHT0FMX0FNT1VOVCIsImdvYWxfYW1vdW50Iiwib3JnYW5pemF0aW9uIiwiT3JnYW5pemF0aW9ucyIsImZpbmRPbmUiLCJ3aGVyZSIsIk9yZ2FuaXphdGlvbktleXMiLCJVVUlEIiwib3JnYW5pemF0aW9uVXVpZCIsInNldE9yZ2FuaXphdGlvbiIsImNvbW1pdCIsInN0YXR1cyIsImpzb24iLCJlcnIiLCJyb2xsYmFjayJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUEsTUFBTUEscUJBQXFDLEdBQUcsT0FBT0MsR0FBUCxFQUFZQyxHQUFaLEVBQWlCQyxJQUFqQixLQUEwQjtBQUN0RSxNQUFJQyxXQUFKOztBQUNBLE1BQUk7QUFDRixVQUFNQyxxQkFBV0MsUUFBWCxDQUFvQkwsR0FBRyxDQUFDTSxJQUF4QixDQUFOO0FBRUFILElBQUFBLFdBQVcsR0FBRyxNQUFNSSxjQUFZSixXQUFaLEVBQXBCO0FBRUEsVUFBTUssS0FBSyxHQUFHLE1BQU1DLGVBQU9DLE1BQVAsQ0FBYztBQUNoQyxPQUFDQyxnQkFBVUMsSUFBWCxHQUFrQlosR0FBRyxDQUFDTSxJQUFKLENBQVNPLElBREs7QUFFaEMsT0FBQ0YsZ0JBQVVHLGtCQUFYLEdBQWdDZCxHQUFHLENBQUNNLElBQUosQ0FBU1MsZ0JBRlQ7QUFHaEMsT0FBQ0osZ0JBQVVLLFdBQVgsR0FBeUJoQixHQUFHLENBQUNNLElBQUosQ0FBU1c7QUFIRixLQUFkLEVBSWpCO0FBQUVkLE1BQUFBO0FBQUYsS0FKaUIsQ0FBcEI7QUFNQSxVQUFNZSxZQUFZLEdBQUcsTUFBTUMsc0JBQWNDLE9BQWQsQ0FBc0I7QUFDL0NDLE1BQUFBLEtBQUssRUFBRTtBQUNMLFNBQUNDLHVCQUFpQkMsSUFBbEIsR0FBeUJ2QixHQUFHLENBQUNNLElBQUosQ0FBU2tCO0FBRDdCO0FBRHdDLEtBQXRCLENBQTNCO0FBTUEsVUFBTWhCLEtBQUssQ0FBQ2lCLGVBQU4sQ0FBc0JQLFlBQXRCLEVBQW9DO0FBQUVmLE1BQUFBO0FBQUYsS0FBcEMsQ0FBTjtBQUVBLFVBQU1BLFdBQVcsQ0FBQ3VCLE1BQVosRUFBTjtBQUVBekIsSUFBQUEsR0FBRyxDQUFDMEIsTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCcEIsS0FBckI7QUFDRCxHQXRCRCxDQXNCRSxPQUFPcUIsR0FBUCxFQUFZO0FBQ1osUUFBSTFCLFdBQUosRUFBaUI7QUFDZkEsTUFBQUEsV0FBVyxDQUFDMkIsUUFBWjtBQUNEOztBQUNENUIsSUFBQUEsSUFBSSxDQUFDMkIsR0FBRCxDQUFKO0FBQ0Q7QUFDRixDQTlCRDs7ZUFnQ2U5QixxQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlcXVlc3RIYW5kbGVyIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgeyBDYXVzZXMsIE9yZ2FuaXphdGlvbnMgfSBmcm9tICdtb2RlbHMnO1xuaW1wb3J0IHsgQ2F1c2VLZXlzLCBPcmdhbml6YXRpb25LZXlzIH0gZnJvbSAnbW9kZWxzL2tleXMnO1xuaW1wb3J0IHNlcUluc3RhbmNlIGZyb20gJ2NvbmZpZy9kYXRhYmFzZS9jb25uJztcbmltcG9ydCB7IGJvZHlTY2hlbWEgfSBmcm9tICcuL3ZhbGlkYXRlJztcblxuY29uc3QgY3JlYXRlQ2F1c2VDb250cm9sbGVyOiBSZXF1ZXN0SGFuZGxlciA9IGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICBsZXQgdHJhbnNhY3Rpb247XG4gIHRyeSB7XG4gICAgYXdhaXQgYm9keVNjaGVtYS52YWxpZGF0ZShyZXEuYm9keSk7XG5cbiAgICB0cmFuc2FjdGlvbiA9IGF3YWl0IHNlcUluc3RhbmNlLnRyYW5zYWN0aW9uKCk7XG5cbiAgICBjb25zdCBjYXVzZSA9IGF3YWl0IENhdXNlcy5jcmVhdGUoe1xuICAgICAgW0NhdXNlS2V5cy5OQU1FXTogcmVxLmJvZHkubmFtZSxcbiAgICAgIFtDYXVzZUtleXMuU1VHR0VTVEVEX0RPTkFUSU9OXTogcmVxLmJvZHkuc3VnZ2VzdGVkX2Ftb3VudCxcbiAgICAgIFtDYXVzZUtleXMuR09BTF9BTU9VTlRdOiByZXEuYm9keS5nb2FsX2Ftb3VudFxuICAgIH0sIHsgdHJhbnNhY3Rpb24gfSk7XG5cbiAgICBjb25zdCBvcmdhbml6YXRpb24gPSBhd2FpdCBPcmdhbml6YXRpb25zLmZpbmRPbmUoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgW09yZ2FuaXphdGlvbktleXMuVVVJRF06IHJlcS5ib2R5Lm9yZ2FuaXphdGlvblV1aWRcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGF3YWl0IGNhdXNlLnNldE9yZ2FuaXphdGlvbihvcmdhbml6YXRpb24sIHsgdHJhbnNhY3Rpb24gfSk7XG5cbiAgICBhd2FpdCB0cmFuc2FjdGlvbi5jb21taXQoKTtcblxuICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKGNhdXNlKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgaWYgKHRyYW5zYWN0aW9uKSB7XG4gICAgICB0cmFuc2FjdGlvbi5yb2xsYmFjaygpO1xuICAgIH1cbiAgICBuZXh0KGVycik7XG4gIH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNyZWF0ZUNhdXNlQ29udHJvbGxlcjtcbiJdfQ==