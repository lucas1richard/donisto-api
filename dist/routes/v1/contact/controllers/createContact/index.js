"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _Contact = _interopRequireDefault(require("../../../../../models/Contact"));

var _jwtSimple = _interopRequireDefault(require("jwt-simple"));

var _validate = require("./validate");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const createContactController = async (req, res, next) => {
  try {
    await _validate.bodySchema.validate(req.body);
    const contact = await _Contact.default.create(req.body);

    const token = _jwtSimple.default.encode({
      id: contact.id,
      uuid: contact.uuid
    }, process.env.JWT_SECRET);

    res.set('token', token).json(contact);
  } catch (err) {
    next(err);
  }
};

var _default = createContactController;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9yb3V0ZXMvdjEvY29udGFjdC9jb250cm9sbGVycy9jcmVhdGVDb250YWN0L2luZGV4LnRzIl0sIm5hbWVzIjpbImNyZWF0ZUNvbnRhY3RDb250cm9sbGVyIiwicmVxIiwicmVzIiwibmV4dCIsImJvZHlTY2hlbWEiLCJ2YWxpZGF0ZSIsImJvZHkiLCJjb250YWN0IiwiQ29udGFjdCIsImNyZWF0ZSIsInRva2VuIiwiand0IiwiZW5jb2RlIiwiaWQiLCJ1dWlkIiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJzZXQiLCJqc29uIiwiZXJyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFFQSxNQUFNQSx1QkFBdUIsR0FBRyxPQUFPQyxHQUFQLEVBQXFCQyxHQUFyQixFQUFvQ0MsSUFBcEMsS0FBMkQ7QUFDekYsTUFBSTtBQUNGLFVBQU1DLHFCQUFXQyxRQUFYLENBQW9CSixHQUFHLENBQUNLLElBQXhCLENBQU47QUFFQSxVQUFNQyxPQUFPLEdBQUcsTUFBTUMsaUJBQVFDLE1BQVIsQ0FBZVIsR0FBRyxDQUFDSyxJQUFuQixDQUF0Qjs7QUFFQSxVQUFNSSxLQUFLLEdBQUdDLG1CQUFJQyxNQUFKLENBQVc7QUFDdkJDLE1BQUFBLEVBQUUsRUFBRU4sT0FBTyxDQUFDTSxFQURXO0FBRXZCQyxNQUFBQSxJQUFJLEVBQUVQLE9BQU8sQ0FBQ087QUFGUyxLQUFYLEVBR1hDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxVQUhELENBQWQ7O0FBS0FmLElBQUFBLEdBQUcsQ0FDQWdCLEdBREgsQ0FDTyxPQURQLEVBQ2dCUixLQURoQixFQUVHUyxJQUZILENBRVFaLE9BRlI7QUFHRCxHQWJELENBYUUsT0FBT2EsR0FBUCxFQUFZO0FBQ1pqQixJQUFBQSxJQUFJLENBQUNpQixHQUFELENBQUo7QUFDRDtBQUNGLENBakJEOztlQW1CZXBCLHVCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVxdWVzdCwgUmVzcG9uc2UsIE5leHRGdW5jdGlvbiB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IENvbnRhY3QgZnJvbSAnbW9kZWxzL0NvbnRhY3QnO1xuaW1wb3J0IGp3dCBmcm9tICdqd3Qtc2ltcGxlJztcbmltcG9ydCB7IGJvZHlTY2hlbWEgfSBmcm9tICcuL3ZhbGlkYXRlJztcblxuY29uc3QgY3JlYXRlQ29udGFjdENvbnRyb2xsZXIgPSBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pID0+IHtcbiAgdHJ5IHtcbiAgICBhd2FpdCBib2R5U2NoZW1hLnZhbGlkYXRlKHJlcS5ib2R5KTtcblxuICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBDb250YWN0LmNyZWF0ZShyZXEuYm9keSk7XG5cbiAgICBjb25zdCB0b2tlbiA9IGp3dC5lbmNvZGUoe1xuICAgICAgaWQ6IGNvbnRhY3QuaWQsXG4gICAgICB1dWlkOiBjb250YWN0LnV1aWRcbiAgICB9LCBwcm9jZXNzLmVudi5KV1RfU0VDUkVUKTtcblxuICAgIHJlc1xuICAgICAgLnNldCgndG9rZW4nLCB0b2tlbilcbiAgICAgIC5qc29uKGNvbnRhY3QpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBuZXh0KGVycik7XG4gIH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNyZWF0ZUNvbnRhY3RDb250cm9sbGVyO1xuIl19